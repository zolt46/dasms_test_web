<h3 class="section-title">➡️ 불출 신청</h3>
<p>총기 또는 탄약의 불출을 신청하는 페이지입니다. 모든 필수 정보를 정확히 입력해주세요.</p>

<div class="form-container">
    <form id="dispatchApplicationForm">
        <h4>개인 정보</h4>
        <div class="form-group">
            <label for="applicantName">성명:</label>
            <input type="text" id="applicantName" name="applicantName" required placeholder="예: 홍길동">
        </div>
        <div class="form-group">
            <label for="applicantRank">계급:</label>
            <select id="applicantRank" name="applicantRank" required>
                <option value="">선택</option>
                <option value="이병">이병</option>
                <option value="일병">일병</option>
                <option value="상병">상병</option>
                <option value="병장">병장</option>
                <option value="하사">하사</option>
                <option value="중사">중사</option>
                <option value="상사">상사</option>
                <option value="원사">원사</option>
                <option value="소위">소위</option>
                <option value="중위">중위</option>
                <option value="대위">대위</option>
                <option value="소령">소령</option>
                </select>
        </div>
        <div class="form-group">
            <label for="militaryId">군번:</label>
            <input type="text" id="militaryId" name="militaryId" required pattern="[0-9]{2}-[0-9]{8}" placeholder="예: 12-34567890">
        </div>
        <div class="form-group">
            <label for="affiliation">소속:</label>
            <input type="text" id="affiliation" name="affiliation" required placeholder="예: 본부중대 1소대">
        </div>

        <h4 class="section-divider">불출 품목 정보</h4>
        <div class="form-group">
            <label>구분:</label>
            <div class="radio-group">
                <input type="radio" id="itemTypeWeapon" name="itemType" value="weapon" checked>
                <label for="itemTypeWeapon">총기</label>
                <input type="radio" id="itemTypeAmmo" name="itemType" value="ammo">
                <label for="itemTypeAmmo">탄약</label>
            </div>
        </div>

        <div id="weaponFields" class="item-fields">
            <div class="form-group">
                <label for="weaponType">총기 종류:</label>
                <select id="weaponType" name="weaponType">
                    <option value="">선택</option>
                    <option value="K2 소총">K2 소총</option>
                    <option value="K1 기관단총">K1 기관단총</option>
                    <option value="K5 권총">K5 권총</option>
                    <option value="K4 유탄기관총">K4 유탄기관총</option>
                    </select>
            </div>
            <div class="form-group">
                <label for="weaponSerialNumber">총기 번호:</label>
                <input type="text" id="weaponSerialNumber" name="weaponSerialNumber" placeholder="예: K2-12345">
            </div>
        </div>

        <div id="ammoFields" class="item-fields" style="display: none;">
            <div class="form-group">
                <label for="ammoType">탄약 종류:</label>
                <select id="ammoType" name="ammoType">
                    <option value="">선택</option>
                    <option value="5.56mm 소총탄">5.56mm 소총탄</option>
                    <option value="9mm 권총탄">9mm 권총탄</option>
                    <option value="K201 유탄">K201 유탄</option>
                    <option value="K4 기관총탄">K4 기관총탄</option>
                    </select>
            </div>
            <div class="form-group">
                <label for="ammoCategory">탄약 구분:</label>
                <select id="ammoCategory" name="ammoCategory">
                    <option value="">선택</option>
                    <option value="실탄">실탄</option>
                    <option value="공포탄">공포탄</option>
                    <option value="훈련탄">훈련탄</option>
                    <option value="경계용(삽탄)">경계용(삽탄)</option>
                    <option value="불량탄">불량탄</option>
                </select>
            </div>
            <div class="form-group">
                <label for="quantity">수량:</label>
                <input type="number" id="quantity" name="quantity" min="1" placeholder="수량 입력">
            </div>
        </div>

        <h4 class="section-divider">불출 및 반납 상세 정보</h4>
        <div class="form-group">
            <label for="dispatchDate">불출 일자:</label>
            <input type="date" id="dispatchDate" name="dispatchDate" required>
        </div>
        <div class="form-group">
            <label for="dispatchTime">불출 예정 시간:</label>
            <input type="time" id="dispatchTime" name="dispatchTime" required>
        </div>
        <div class="form-group">
            <label for="purposeOfUse">사용 목적:</label>
            <select id="purposeOfUse" name="purposeOfUse" required>
                <option value="">선택</option>
                <option value="훈련">훈련</option>
                <option value="근무">근무</option>
                <option value="사격">사격</option>
                <option value="정비">정비</option>
                <option value="교체">교체</option>
                </select>
        </div>
        <div class="form-group">
            <label for="dispatchLocation">불출 장소:</label>
            <select id="dispatchLocation" name="dispatchLocation" required>
                <option value="">선택</option>
                <option value="무기고">무기고</option>
                <option value="총기함1">총기함1</option>
                <option value="총기함2">총기함2</option>
                <option value="탄약고 A">탄약고 A</option>
                <option value="탄약고 B">탄약고 B</option>
                </select>
        </div>
        <div class="form-group">
            <label for="plannedReturnDate">반납 예정 일자:</label>
            <input type="date" id="plannedReturnDate" name="plannedReturnDate" required>
        </div>
        <div class="form-group">
            <label for="plannedReturnTime">반납 예정 시간:</label>
            <input type="time" id="plannedReturnTime" name="plannedReturnTime" required>
        </div>
        <div class="form-group full-width">
            <label for="specialNotes">특이사항:</label>
            <textarea id="specialNotes" name="specialNotes" rows="3" placeholder="기타 특이사항 (선택 사항)"></textarea>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn submit-btn">불출 신청</button>
            <button type="reset" class="btn reset-btn">초기화</button>
        </div>
    </form>
</div>

<style>
    /* management_return.html, management_dispatch.html, work_input.html 에 적용 */
    .form-container {
        background-color: var(--sidebar-bg);
        border: 1px solid var(--border-color);
        padding: 20px;
        border-radius: 8px;
        width: 100%; /* 부모의 전체 너비 사용 */
        max-width: 900px; /* 예를 들어, 너무 넓어지지 않도록 최대 너비 설정 (조정 가능) */
        /* margin: auto; /* main_page.html에서 중앙 정렬을 제거했으므로, 이 페이지 자체에서 중앙 정렬하려면 다시 추가해야 합니다.
                        페이지의 영역을 '꽉 채우는' 목적이라면 제거하는 것이 맞습니다. */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .form-container h4 {
        color: var(--brown-accent);
        font-size: 1.2em;
        margin-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 5px;
    }

    .section-divider {
        margin-top: 30px; /* 섹션 간 구분 마진 */
    }

    .form-group {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: var(--text-color);
        font-weight: bold;
        font-size: 0.9em;
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group input[type="date"],
    .form-group input[type="time"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background-color: rgba(255, 255, 255, 0.08); /* 약간 투명한 배경 */
        color: var(--text-color);
        font-size: 0.9em;
        outline: none;
        transition: border-color 0.3s ease;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="number"]:focus,
    .form-group input[type="date"]:focus,
    .form-group input[type="time"]:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        border-color: var(--active-menu-item);
    }

    .form-group textarea {
        resize: vertical; /* 세로 크기 조절 허용 */
        min-height: 60px;
    }

    .radio-group {
        display: flex;
        gap: 20px;
        margin-top: 5px;
    }

    .radio-group input[type="radio"] {
        margin-right: 5px;
        accent-color: var(--active-menu-item); /* 라디오 버튼 색상 변경 */
    }
    .radio-group label {
        font-weight: normal; /* 라디오 버튼 레이블 굵기 조절 */
    }

    .item-fields {
        border: 1px dashed var(--border-color);
        padding: 15px;
        margin-top: 15px;
        border-radius: 5px;
    }

    .full-width {
        grid-column: span 2; /* 2열 전체 사용 */
    }

    .form-actions {
        margin-top: 30px;
        text-align: right;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .submit-btn {
        background-color: var(--active-menu-item);
        color: white;
        margin-left: 10px;
    }

    .submit-btn:hover {
        background-color: #3f7d22; /* 살짝 어두운 녹색 */
        transform: translateY(-2px);
    }

    .reset-btn {
        background-color: var(--border-color);
        color: var(--text-color);
    }

    .reset-btn:hover {
        background-color: #5a6d63; /* 살짝 밝은 회색 */
        transform: translateY(-2px);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const itemTypeWeapon = document.getElementById('itemTypeWeapon');
        const itemTypeAmmo = document.getElementById('itemTypeAmmo');
        const weaponFields = document.getElementById('weaponFields');
        const ammoFields = document.getElementById('ammoFields');

        // 초기 상태 설정
        function toggleItemFields() {
            if (itemTypeWeapon.checked) {
                weaponFields.style.display = 'block';
                ammoFields.style.display = 'none';
                // 총기 필드를 필수로 설정 (select와 input에 적용)
                weaponFields.querySelectorAll('select, input').forEach(el => el.setAttribute('required', 'true'));
                ammoFields.querySelectorAll('select, input').forEach(el => el.removeAttribute('required'));
            } else if (itemTypeAmmo.checked) {
                weaponFields.style.display = 'none';
                ammoFields.style.display = 'block';
                // 탄약 필드를 필수로 설정 (select와 input에 적용)
                ammoFields.querySelectorAll('select, input').forEach(el => el.setAttribute('required', 'true'));
                weaponFields.querySelectorAll('select, input').forEach(el => el.removeAttribute('required'));
            }
        }

        // 라디오 버튼 변경 시 이벤트
        itemTypeWeapon.addEventListener('change', toggleItemFields);
        itemTypeAmmo.addEventListener('change', toggleItemFields);

        // 페이지 로드 시 초기 호출
        toggleItemFields();

        // 폼 제출 시 (예시)
        document.getElementById('dispatchApplicationForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 기본 제출 동작 방지

            // 여기에 폼 데이터 수집 및 처리 로직을 구현합니다.
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // 라디오 버튼에 따라 필요 없는 필드는 제거
            if (data.itemType === 'weapon') {
                delete data.ammoType;
                delete data.ammoCategory;
                delete data.quantity;
            } else { // ammo
                delete data.weaponType;
                delete data.weaponSerialNumber;
            }

            console.log('불출 신청 데이터:', data);
            alert('불출 신청이 접수되었습니다! (콘솔 확인)');
            // 실제 환경에서는 fetch 또는 XMLHttpRequest를 사용하여 서버로 데이터 전송

            this.reset(); // 폼 초기화
            toggleItemFields(); // 초기화 후 필드 상태 다시 설정
        });

        // 폼 초기화 버튼 클릭 시 (필요한 경우 추가 로직)
        document.getElementById('dispatchApplicationForm').addEventListener('reset', function() {
             setTimeout(toggleItemFields, 50); // 초기화 후 잠시 기다렸다가 필드 상태 다시 설정
        });
    });
</script>